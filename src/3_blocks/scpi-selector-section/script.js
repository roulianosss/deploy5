const data = [
  {
    title: "PIERVAL SANTE",
    sector: "Santé",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["Europe"],
      name: "Europe"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 1020,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "LF AVENIR SANTE",
    sector: "Santé",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["Europe", "France"],
      name: "Europe, Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 300,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "PRIMOVIE",
    sector: "Santé",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["Europe"],
      name: "Europe"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 2030,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "PF HOSPITALITE EUROPE",
    sector: "Santé",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["Europe"],
      name: "Europe"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 1000,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "PRIMOFAMILY",
    sector: "Résidentiel",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 2040,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "VENDOME REGIONS",
    sector: "Diversifiée",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 3350,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "INTERPIERRE France",
    sector: "Diversifiée",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },

    minimumAccessAmount: 5250,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "CŒUR DE REGION",
    sector: "Diversifiée",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },

    minimumAccessAmount: 659,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "ESG PIERRE CAPITALE",
    sector: "Diversifiée",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 1025,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "EPARGNE FONCIERE",
    sector: "Bureaux",
    capitalization: "5 061 394 250 €",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "835 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,40%"
    },
    minimumAccessAmount: 835,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "EPARGNE PIERRE",
    sector: "Bureaux",
    capitalization: "1 774 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "5,36%"
    },
    minimumAccessAmount: 2080,
    logoUrl: "./assets/logos/atland_voisin.png"
  },
  {
    title: "LF EUROPIMMO",
    sector: "Bureaux",
    capitalization: "103 289 055 €",
    geographicalArea: {
      areas: ["Europe"],
      name: "Europe"
    },
    subscriptionPrice: "1045 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,02%"
    },
    minimumAccessAmount: 1045,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "EFIMMO 1",
    sector: "Bureaux",
    capitalization: "1 876 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "237 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,91%"
    },
    minimumAccessAmount: 2370,
    logoUrl: "./assets/logos/la_francaise.png"
  },
  {
    title: "PRIMOPIERRE",
    sector: "Bureaux",
    capitalization: "3,9 Mds €",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "208 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,77%"
    },
    minimumAccessAmount: 2080,
    logoUrl: "./assets/logos/primonial.png"
  },
  {
    title: "PFO2",
    sector: "Bureaux",
    capitalization: "2 848 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "196 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,59%"
    },
    minimumAccessAmount: 5880,
    logoUrl: "./assets/logos/perial.png"
  },
  {
    title: "PF GRAND PARIS",
    sector: "Bureaux",
    capitalization: "1 228 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "544 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,42%%"
    },
    minimumAccessAmount: 5440,
    logoUrl: "./assets/logos/perial.png"
  },
  {
    title: "IMMORENTE",
    sector: "Commerces",
    capitalization: "1 228 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "544 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,42%%"
    },
    minimumAccessAmount: 1360,
    logoUrl: "./assets/logos/perial.png"
  },
  {
    title: "ACTIVIMMO",
    sector: "Logistique",
    capitalization: "1 228 M€",
    geographicalArea: {
      areas: ["France"],
      name: "Ile-de-France"
    },
    subscriptionPrice: "544 €",
    payoutRatio: {
      name: "Taux de distribution en 2021 :",
      value: "4,42%%"
    },

    minimumAccessAmount: 3100,
    logoUrl: "./assets/logos/perial.png"
  }
];

const selectedOptions = {
  initialInvestissement: 100000,
  // sectoralCategory: ["Commerces"],
  // geographicalArea: ["France", "Europe"],
  selectedBtns: ["France", "Europe", "Commerces"]
};

const cardsContainer = document.querySelector('.scpi-selector__selectors-container__resultsCards')
const allBtns = document.querySelectorAll('.scpi-selector__selectors-container__sectoralCategory__btns-container__btn, .scpi-selector__selectors-container__geographicalArea__btns-container__btn')
const inputRange = document.querySelector('.scpi-selector__selectors-container__initial-investissement-container input')
const labelInput = document.querySelector('.scpi-selector__selectors-container__initial-investissement-container label')


inputRange.addEventListener('input', handleInputRange)
allBtns.forEach(btn => btn.addEventListener('click', (e) => handleClick(e, selectedOptions.selectedBtns)))

function handleInputRange() {
  selectedOptions.initialInvestissement = inputRange.value
  const valueInPercentage = ((inputRange.value - inputRange.min) / (inputRange.max - inputRange.min)) * 100;
  const formattedLabelNumber = inputRange.value.split("");
  formattedLabelNumber.splice(-3, 0, " ");
  labelInput.textContent = `${formattedLabelNumber.join("")} €`
  inputRange.style.background = `linear-gradient(to right, #ff6442 0%, #ff6442 ${valueInPercentage}%, #fbe1da ${valueInPercentage}%, #fbe1da 100%)`;
  displayCards(filteredCards(selectedOptions))
}

function handleClick(e, selectedBtns) {
  const btnLabel = e.target.getAttribute('data-attr')
  handleSelectedOptionBtn(selectedBtns, btnLabel)
}

function handleSelectedOptionBtn(array, string) {
  const indexSelectedBtn = array.indexOf(string);
  if (indexSelectedBtn !== -1) {
    array.splice(indexSelectedBtn, 1);
  } else {
    array.push(string); 
  }
  handleBtnStyle()
}

function handleBtnStyle() {
  allBtns.forEach(btn => {
    const isButtonSelected = selectedOptions.selectedBtns.includes(btn.getAttribute('data-attr'))
    btn.style.background = isButtonSelected ? '#ff6442' : '#f3f5f6'
    btn.style.color = isButtonSelected ? '#f3f5f6' : '#001329'
  })
  displayCards(filteredCards(selectedOptions))
}

function displayCards(cards) {
  cardsContainer.innerHTML = ''
  cards.forEach(card => {
    cardsContainer.innerHTML += `
    <div class="scpi-selector__selectors-container__resultsCards__card">
      <div class="scpi-selector__selectors-container__resultsCards__card__header">
        <h3>${card.title}</h3>
      </div>
      <div class="scpi-selector__selectors-container__resultsCards__card__body">
        <div class="scpi-selector__selectors-container__resultsCards__card__body__descriptions">
          <p>Capitalisation : <span>${card.capitalization}</span></p>
          <p>Zone géographique : <span>${card.geographicalArea.name}</span></p>
          <p>Prix de souscription : <span>${card.subscriptionPrice}</span></p>
          <p>${card.payoutRatio.name} : <span>${card.payoutRatio.value}</span></p>
        </div>
        <img src="${card.logoUrl}" alt="logo">
        <div class="scpi-selector__selectors-container__resultsCards__card__body__btns-container">
          <a class="button button--secondary button--light-theme button--small" href="#">En savoir plus</a>
          <a class="button button--primary button--small" href="#">Souscrire avec un conseiller</a>
        </div>
      </div>
    </div>
    `
  })
}


function filteredCards(selectedOptions) {
  return data
    .filter(
      (card) =>
        card.minimumAccessAmount <= selectedOptions.initialInvestissement
    )
    .filter((card) => selectedOptions.selectedBtns.includes(card.sector))
    .filter((card) =>
      card.geographicalArea.areas
        .map((area) => selectedOptions.selectedBtns.includes(area))
        .every(Boolean)
    );
}

handleBtnStyle()